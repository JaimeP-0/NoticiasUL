---
// Layout principal con Tailwind CSS
---

<!doctype html>
<html lang="es" class="h-full">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>Noticias Universitarias</title>
	</head>
	<body class="min-h-full bg-gray-50 dark:bg-gray-900 transition-colors">
		<!-- Header con reloj -->
		<header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
			<div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
				<a href="/" class="text-2xl font-bold text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
					Noticias Universitarias
				</a>
				<div class="flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400">
					<i class="bi bi-clock"></i>
					<span id="reloj-actual" class="tabular-nums"></span>
					<span id="usuario-actual" class="ml-4 hidden"></span>
					<button id="btn-logout" class="ml-2 px-3 py-1 text-xs bg-red-600 hover:bg-red-700 text-white rounded hidden transition-colors">
						Cerrar Sesión
					</button>
				</div>
			</div>
		</header>

		<!-- Menú de navegación -->
		<nav class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
			<div class="max-w-7xl mx-auto px-4">
				<ul class="flex justify-center gap-6 py-2">
					<li>
						<a href="/noticias" class="nav-link px-3 py-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 border-b-2 border-transparent hover:border-blue-600 transition-colors">
							Noticias
						</a>
					</li>
					<li>
						<a href="/agregar" class="nav-link px-3 py-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 border-b-2 border-transparent hover:border-blue-600 transition-colors">
							Agregar
						</a>
					</li>
				</ul>
			</div>
		</nav>

		<!-- Contenido principal -->
		<main class="max-w-4xl mx-auto px-4 py-8">
			<slot />
		</main>

		<!-- Botón flotante para cambiar tema -->
		<div class="fixed bottom-4 left-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-50">
			<ul class="flex gap-1 p-1">
				<li class="theme-toggle" data-bs-theme-value="light" title="Claro">
					<button class="p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
						<i class="bi bi-sun-fill text-yellow-500"></i>
					</button>
				</li>
				<li class="theme-toggle" data-bs-theme-value="dark" title="Oscuro">
					<button class="p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
						<i class="bi bi-moon-stars-fill text-blue-500"></i>
					</button>
				</li>
				<li class="theme-toggle" data-bs-theme-value="auto" title="Auto">
					<button class="p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
						<i class="bi bi-circle-half text-gray-500"></i>
					</button>
				</li>
			</ul>
		</div>

		<!-- Scripts -->
		<script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous" defer></script>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
		
		<script>
			// Funciones globales del Layout
			let bootstrapTheme = localStorage.getItem('theme');

			function detectSystemTheme() {
				return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
			}

			function filterTheme(theme) {
				return theme === 'auto' ? detectSystemTheme() : theme;
			}

			function setTheme(theme) {
				const html = document.documentElement;
				html.classList.remove('light', 'dark');
				html.classList.add(filterTheme(theme));
				localStorage.setItem('theme', theme);
			}

			function showActiveTheme(theme) {
				document.querySelectorAll('.theme-toggle').forEach((el) => {
					el.classList.remove('bg-blue-100', 'dark:bg-blue-900');
				});
				const active = document.querySelector(`[data-bs-theme-value="${theme}"]`);
				if (active) active.classList.add('bg-blue-100', 'dark:bg-blue-900');
			}

			// Inicialización
			document.addEventListener('DOMContentLoaded', function() {
				// Tema inicial
				bootstrapTheme = localStorage.getItem('theme') || 'auto';
				setTheme(bootstrapTheme);
				showActiveTheme(bootstrapTheme);

				document.querySelectorAll('.theme-toggle').forEach((el) => {
					el.addEventListener('click', () => {
						bootstrapTheme = el.getAttribute('data-bs-theme-value');
						setTheme(bootstrapTheme);
						showActiveTheme(bootstrapTheme);
					});
				});

				// Reloj
				const reloj = document.getElementById('reloj-actual');
				function actualizarReloj() {
					if (!reloj) return;
					reloj.textContent = new Date().toLocaleString('es-ES');
				}
				actualizarReloj();
				setInterval(actualizarReloj, 1000);

				// Verificar autenticación y mostrar usuario
				const usuario = localStorage.getItem('auth_user');
				const usuarioDiv = document.getElementById('usuario-actual');
				const btnLogout = document.getElementById('btn-logout');
				
				if (usuario && usuarioDiv && btnLogout) {
					usuarioDiv.textContent = `Bienvenido ${usuario}`;
					usuarioDiv.classList.remove('hidden');
					btnLogout.classList.remove('hidden');
					
					btnLogout.addEventListener('click', () => {
						localStorage.removeItem('auth_user');
						localStorage.removeItem('auth_token');
						window.location.href = '/';
					});
				}

				// Marcar enlace activo según la URL actual
				const currentPath = window.location.pathname;
				document.querySelectorAll('.nav-link').forEach((link) => {
					if (link.getAttribute('href') === currentPath) {
						link.classList.add('active');
					}
				});
			});
		</script>
	</body>
</html>

<style>
	.nav-link.active {
		border-bottom-color: rgb(37 99 235) !important;
		color: rgb(37 99 235) !important;
	}
</style>
